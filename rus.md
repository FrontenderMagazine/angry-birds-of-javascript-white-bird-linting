# Злые JavaScript-птицы — Белая птица: Линтинг


## Введение

![][1] 

Дьявольское стадо свиней похитило всё из архитектуры интерфейса у невинной стаи птиц, и теперь птицы хотят вернуть себе утраченное!

Сплочённая команда героических птиц будут атаковать этих подлых свиней до тех пор, пока не вернут то, что принадлежит им по праву — фронтенд архитектуру JavaScript-приложения.

Достигнут ли птицы успеха? Победят ли они своих пахнущих беконом врагов? Давайте разберёмся со всем этим вместе в новом тревожном эпизоде злых JavaScript-птиц! 

> Взгляните на **[серию постов][2]** с полным списком эпизодов атак JavaScript-птиц!
> ![][3]


### Предыдущие атаки

* [Красная Птица — Немедленно вызываемая функция][20]
* [Голубая Птица — События][21]
* [Жёлтая Птица — RequireJS][22]
* [Чёрная Птица — Backbone][23]


### Атака Белой Птицы

В этом эпизоде мы рассмотрим поближе белую птицу, которая сначала кажется безвредной, но как только она применит строгие требования к стилю программирования и начнёт учинять проверки кода, то свиньи убегут в тот же момент, громко визжа. Медленно и потихоньку птицы вернут себе всё, чтобы уже никогда не отдавать!


## Что же украли свиньи?

Все птицы учились программированию по-разному. Некоторые птицы были самоучками, а некоторые птицы закончили университет. Но даже среди похожих групп птицы сильно различались по опыту и способностям. Когда птицы попробовали сделать своё первое большое приложение, то случилась катастрофа. Каждая птица думала, что то, как она пишет код — это правильный и к тому же единственно верный способ написания кода, и именно это стало проблемой. Однажды мудрая Белая Птица пришла и предложила придерживаться общих правил и лучших практик. А после этого Белая Птица также рассказала про несколько инструментов, которые будут помогать соответствовать выбранным стандартам, находить несоответствия и разрешать их до того, как куча похожих проблем превратится в снежный ком.

Однако в ходе недавнего нападения свиньи стащили документы со стандартами программного кода и инструменты проверки качества кода! В результате, одну из Белых Птиц попросили помочь вернуть украденное. Белая Птица будет использовать непреодолимую силу качества и стандартов, чтобы уничтожить свиней и забрать то, что принадлежит птицам.


## Стандарты JavaScript-программирования

В мире существует много стандартов, из которых всегда можно выбрать подходящий. Самая важная вещь про стандарты заключается в том, что необходимо выбрать один из них и придерживаться его. Если вы работаете в команде, то все должны быть согласны с выбранным стандартом. Если вы не можете выбрать один из существующих, то следует выбрать наиболее подходящий и применить к нему несколько исключений.

После этого вы обнаружите, что…

1.   Разработчик начинает быстрее вникать в чужой код
2.   Мерджи в вашем репозитории перестают быть такими ужасными
3.   Наличие на руках стандарта позволяет снизить недоработки
4.   Программная база кода становится более унифицированной
5.   Холивары «CamelCase vs Underscore» ушли в прошлое
6.   …
7.   Профит!

Расскажу про некоторые нравящиеся мне стандарты…

*   Стандарт Дугласа Крокфорда [Соглашения по стилю кода для языка JavaScript][29]
*   Стандарт Рика Уолдрона (Rich Waldron) ([@rwaldron][30]) [Idiomatic.js — Принципы написания последовательного JavaScript-кода][31] ← Рекомендую
*   [Стандарт jQuery][32] ← Рекомендую
*   [Стандарт Google][33]

Эдди Османи (Addy Osmani [@addyosmani][4]) написал отличный пост, озаглавленный 
«[JavaScript Style Guides And Beautifiers][5]», который достаточно подробно рассказывает про некоторые стандарты и стили программирования с примерами того, как следует эти стандарты соблюдать.


## JavaScript-линтинг

Линтер — инструмент, помогающий находить ошибки, опечатки и прочие возможные проблемы в вашем коде. В большинстве случаев он может помочь придерживаться любого выбранного вами стандарта.

На данный момент существует несколько JavaScript-линтеров, но мне больше всего нравится [JSHint][6], созданный Антоном Ковалёвым ([@valueof][7]). JSHint вырос из желания сообщества развивать его отдельно от библиотеки JSLint, написанной Дугласом Крокфордом (Douglas Crockford). Мне нравится наблюдать за ростом проекта, за добавлением багов и новых фич. JSHint имеет очень много настроек, и из них вы можете выбирать те, с которыми вашей команде будет удобно работать.

Стандартные проверки JSHint помогут вам удостовериться, что…

*   Вы используете `===` вместо `==` 
*   Используете только заранее определённые переменные
*   Существование неиспользуемых переменных
*   Создание функций внутри циклов
*   И много чего ещё

Полный список доступных опций смотрите в [документации JSHint][8]

Некоторые последние нововведения, которые мне действительно нравятся:

*   `maxcomplexity` — Максимальная цикломатическая сложность (взгляните на цитату из википедии после списка)
*   `maxstatements` — Максимальное количество инструкций в функции
*   `maxparams` — Максимальное количество аргументов в функции
*   `maxdepth` — Максимальная глубина вложения функций
*   `maxlen` — Максимальная длина строчек кода

> «Цикломатическая сложность — структурная (или топологическая) мера сложности
> программ, используемая для измерения качества программного обеспечения,
> основанная на методах статического анализа кода.»  
> --<http://ru.wikipedia.org/wiki/Цикломатическая_сложность>

    /*jshint maxparams:3, maxdepth:2, maxstatements:5, maxcomplexity:3, maxlen:80 */
    /*global console:false */
     
    (function( undefined ) {
        "use strict";
     
        function test1( arg1, arg2, arg3, arg4 ) {
            console.log( "too many parameters!" );
            if ( arg1 === 1 ) {
                console.log( arg1 );
                if ( arg2 === 2 ) {
                    console.log( arg2 );
                    if( arg3 === 3 ) {
                        console.log( "too much nesting!" ); console.log( arg3 ); console.log( arg4 );
                    }
                }
            }
            console.log( "too many statements!" );
        }
     
        test1( 1, 2, 3, 4 );
    }());

Следующие ошибки были сгенерированы с помощью JSHint, запущенного на участке кода, приведённого выше.

![][9] 

К счастью, вам не придется запускать JSHint с формы на сайте каждый раз, чтобы проверить ваш код. Есть несколько способов интеграции JSHint в ваш редактор:

* VIM Plugin ([jshint.vim][24])
* Sublime Text 2(3) Extension ([Sublime Linter][25])
* TextMate Bundle ([JSHint TextMate Bundle][26])
* Visual Studio [Web Essentials][27]
* Eclipse IDE ([JSHint Integration][28])

> В эпизоде с Могучим орлом мы обсудим другой способ использования JSHint из
> командной строки или в автоматическом режиме.


## Анализ JavaScript-кода

Линтинг кода — это бесконечно полезно, но иногда было бы неплохо получить чуть более умный анализ вашего кода и только после этого углубляться в отдельные части приложения.

К счастью, существует [Plato][10], который проанализирует ваш код и в результате покажет вам график, на котором вы сможет рассмотреть сложность вашего приложения. Plato запускается с помощью Node и устанавливается с помощью команды `npm install plato -g`.

После того как вы установили Plato, можете запустить его в терминале с помощью команды `plato -r -d report myDirectory`, она запустит анализ рекурсивно по папке *myDirectory* и сохранит результаты в папку *report*.

Если вы запустите анализ репозитория jQuery, то он будет похож на картинку ниже. Как вы можете заметить, общее число строк уменьшается со временем, что хорошо. Поддержка этого кода достаточно дешёвая, ниже есть график с результатами поддерживаемости каждого отдельного файла. Дальше на странице отчёта приведён график синтаксических и JSLint ошибок по каждому файлу.

![][11] 

Если вы углубитесь в какой-то конкретный файл, то вы увидите нечто подобное. Наглядная чать этого отчёта в том, что он разделяет каждую функцию по сложности и  количеству строк кода и показывает в удобном для понимания порядке. Вы можете быстро перейти на различные части файла, чтобы посмотреть, что нашёл Plato.

![][12] 

Вы можете посмотреть [отчёт по jQuery][13] в репозитории Plato на гитхабе.


## В атаку!

Пример ниже — простейший клон Angry Birds с использованием [boxbox][14], фреймворка для [box2dweb][15] физического JavaScript-движка, написанный [Грегом Смитом][17] (Greg Smith) из [Bocoup][16].

> Используйте _пробел_ для запуска Белой Птицы и стрелочки для управления

[![][18]][19]

### Заключение

Фронтенд приложения усложняются очень быстро. Если ваши разработчики не на одной волне друг с другом, то всё может сломаться очень быстро и как карточный домик, особенно на больших проектах. Если у вас будет единый стандарт стиля программирования и внедрённые инструменты проверки качества кода для нахождения неоднозначных мест задолго до того, как они станут проблемой, то тогда ваш проект придёт к успеху с большей долей вероятности.

Осталось ещё много украденных свиньями веб-технологий. Оставайтесь с нами и увидите, как следующая птица возьмёт реванш. Пиу-пиу!


 [1]: img/angry_birds_wall_decal_by_graphicwolf-d4fwzrc.jpg
 [2]: http://www.elijahmanor.com/2013/03/angry-birds-of-javascript-series.html
 [3]: img/white-bird.png
 [4]: http://twitter.com/addyosmani
 [5]: http://addyosmani.com/blog/javascript-style-guides-and-beautifiers/
 [6]: http://jshint.com/
 [7]: http://twitter.com/valueof
 [8]: http://jshint.com/docs/
 [9]: img/4-3-2013+10-33-12+PM.png
 [10]: https://github.com/jsoverson/plato
 [11]: img/jquery-top-level.png
 [12]: img/jquery-drill-complexity.png
 [13]: http://jsoverson.github.com/plato/examples/jquery/
 [14]: http://incompl.github.com/boxbox/
 [15]: https://code.google.com/p/box2dweb/
 [16]: http://bocoup.com/
 [17]: http://twitter.com/_gsmith
 [18]: img/Screenshot+on+4.4.2013+at+12.14.59+AM.png
 [19]: http://jsfiddle.net/4QG5Q/1/show
 [20]: http://www.elijahmanor.com/angry-birds-of-javascript-red-bird-iife/
 [21]: http://www.elijahmanor.com/angry-birds-of-javascript-blue-bird-events/
 [22]: http://www.elijahmanor.com/angry-birds-of-javascript-yellow-bird-requirejs/
 [23]: http://www.elijahmanor.com/angry-birds-of-javascript-black-bird-backbone/
 [24]: https://github.com/walm/jshint.vim
 [25]: https://github.com/Kronuz/SublimeLinter
 [26]: http://fgnass.posterous.com/jslint-in-textmate
 [27]: http://vswebessentials.com
 [28]: http://github.eclipsesource.com/jshint-eclipse/
 [29]: http://javascript.crockford.com/code.html
 [30]: https://twitter.com/rwaldron
 [31]: https://github.com/rwaldron/idiomatic.js
 [32]: http://contribute.jquery.org/style-guide/js/
 [33]: http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml
